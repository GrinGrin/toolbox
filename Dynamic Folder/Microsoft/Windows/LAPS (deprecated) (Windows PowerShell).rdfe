{"Name":"Dynamic Folder Export","Objects":[{"Type":"DynamicFolder","Name":"Server (LAPS)","Notes":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\t<head>\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\t\t</title>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t.cs2654AE3A{text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt}\r\n\t\t\t.csAF99984B{color:#000000;background-color:transparent;font-family:Calibri;font-size:14pt;font-weight:bold;font-style:normal;}\r\n\t\t\t.csC8F6D76{color:#000000;background-color:transparent;font-family:Calibri;font-size:11pt;font-weight:normal;font-style:normal;}\r\n\t\t\t.cs26DADAAD{color:#000000;background-color:transparent;font-family:Calibri;font-size:11pt;font-weight:normal;font-style:normal;text-decoration: none;}\r\n\t\t\t.csCCA9035D{color:#0000FF;background-color:transparent;font-family:Calibri;font-size:11pt;font-weight:normal;font-style:normal;text-decoration: underline;}\r\n\t\t\t.csCB8A910D{color:#000000;background-color:transparent;font-family:Calibri;font-size:12pt;font-weight:bold;font-style:normal;}\r\n\t\t\t.cs9579B52F{color:#3C3C3C;background-color:transparent;font-family:Calibri;font-size:11pt;font-weight:bold;font-style:italic;}\r\n\t\t\t.cs56A2682C{color:#3C3C3C;background-color:transparent;font-family:Calibri;font-size:11pt;font-weight:normal;font-style:normal;}\r\n\t\t\t.cs747BF1FB{color:#000000;background-color:transparent;font-family:Calibri;font-size:11pt;font-weight:bold;font-style:italic;}\r\n\t\t\t.cs6DC30935{color:#3C3C3C;background-color:transparent;font-family:Calibri;font-size:11pt;font-weight:normal;font-style:normal;text-decoration: none;}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t<p class=\"cs2654AE3A\"><span class=\"csAF99984B\">Local Administrator Password Solution (LAPS)</span></p><p class=\"cs2654AE3A\"><span class=\"csC8F6D76\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csC8F6D76\">More information on LAPS can be found here:<br/><a class=\"cs26DADAAD\" href=\"https://www.microsoft.com/en-us/download/details.aspx?id=46899\"><span class=\"csCCA9035D\">https://www.microsoft.com/en-us/download/details.aspx?id=46899</span></a></span></p><p class=\"cs2654AE3A\"><span class=\"csC8F6D76\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csCB8A910D\">Requirements:</span></p><p class=\"cs2654AE3A\"><span class=\"csC8F6D76\">The dynamic credential script executes the </span><span class=\"cs9579B52F\">Get-AdmPwdPassword</span><span class=\"cs56A2682C\"> cmdlet of the </span><span class=\"cs9579B52F\">AdmPwd</span><span class=\"cs747BF1FB\">.</span><span class=\"cs9579B52F\">PS</span><span class=\"cs56A2682C\"> module:<br/><a class=\"cs6DC30935\" href=\"https://www.powershellgallery.com/packages/AdmPwd.PS\"><span class=\"csCCA9035D\">https://www.powershellgallery.com/packages/AdmPwd.PS</span></a></span></p><p class=\"cs2654AE3A\"><span class=\"cs56A2682C\">Make sure the module is installed/available on your system!</span></p><p class=\"cs2654AE3A\"><span class=\"csC8F6D76\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csCB8A910D\">Configuration:</span></p><p class=\"cs2654AE3A\"><span class=\"csC8F6D76\">The dynamic folder script creates a list of available machine from the Active Directory. Configure the </span><span class=\"cs747BF1FB\">SearchBase</span><span class=\"csC8F6D76\"> path in the </span><span class=\"cs747BF1FB\">Custom Properties</span><span class=\"csC8F6D76\">.</span></p></body>\r\n</html>\r\n","CustomProperties":[{"Name":"SearchBase","Type":"Text","Value":"OU=Server,OU=contoso,DC=com"}],"ScriptInterpreter":"powershell","DynamicCredentialScriptInterpreter":"powershell","DynamicCredentialScript":"$ErrorActionPreference = \"Stop\"\r\n\r\nImport-Module AdmPwd.PS\r\n\r\n$Pass = Get-AdmPwdPassword -Computername $Target.Name$\r\n\r\n$JSON = \"\"\r\n$JSON += \"{`n\"\r\n$JSON += \"  `\"Username`\" : `\".\\\\Administrator`\",`n\"\r\n$JSON += \"  `\"Password`\" : `\"$($Pass.Password)`\"`n\"\r\n$JSON += \"}`n\"\r\n\r\nWrite-Host $JSON\r\n\r\n\r\n","Script":"$ErrorActionPreference = \"Stop\"\r\n\r\n[string] $JSON = \"{ `\"Objects`\" : [ `n\"\r\n\r\n$JSON += \"{`n\"\r\n$JSON += \" `\"Type`\" : `\"DynamicCredential`\",`n\"\r\n$JSON += \" `\"Name`\" : `\"Administrator`\",`n\"\r\n$JSON += \" `\"ID`\" : `\"LAPS`\"`n\"\r\n$JSON += \"},`n\"\r\n\r\nforeach ($comp in (Get-ADComputer -SearchBase $CustomProperty.SearchBase$ -filter *))\r\n{\r\n    $JSON += \"{`n\"\r\n    $JSON += \" `\"Type`\" : `\"RemoteDesktopConnection`\",`n\"\r\n    $JSON += \" `\"Name`\" : `\"$($comp.Name)`\",`n\"\r\n    $JSON += \" `\"ComputerName`\" : `\"$($comp.DNSHostName)`\",`n\"\r\n\t$JSON += \" `\"Path`\" : `\"Connections`\",`n\"\r\n\t$JSON += \" `\"CredentialID`\" : `\"LAPS`\"`n\"\r\n    $JSON += \"},`n\"\r\n}\r\n\r\n$JSON = $JSON.Substring(0, $JSON.Length - 2)\r\n$JSON += \"`n]`n}`n\"\r\n\r\nWrite-Host $JSON"}]}
